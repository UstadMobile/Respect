appId: world.respect.app
onFlowStart:
  - clearState: world.respect.app
  - runScript:
      file: "scripts/school_init.js"
      env:
        TESTCONTROLLER_URL: ${TESTCONTROLLER_URL}
        SCHOOL_ADMIN_PASSWORD: ${SCHOOL_ADMIN_PASSWORD}
        DIR_ADMIN_AUTH_HEADER: ${DIR_ADMIN_AUTH_HEADER}
        SCHOOL_URL: ${SCHOOL_URL}
        SCHOOL_NAME: ${SCHOOL_NAME}
        URL_SUBSTITUTION: ${URL_SUBSTITUTION}
        NAME: "003_admin_user_assigns_assignment_to_a_class_test"

onFlowComplete:
  - runScript:
      file: "scripts/teardown.js"
---
# Admin setup
- runFlow: "subflows/school_admin_login_flow.yaml"

# Add app, class, then add Student and Teacher to class
- runFlow:
    file: "subflows/add_app.yaml"
- runFlow:
    file: "subflows/add_class.yaml"
    env:
      CLASS_NAME: New Class

# Temporarily disabled: Add Student flow.
# This will be reused later as part of the "Manage Assignment" task.
#- runFlow:
#    file: "subflows/add_person_to_a_class.yaml"
#    env:
#
#      ADD_USER: "Add Student"
#      FIRSTNAME: "StudentA"
#      LASTNAME:  "User"
#      GENDER: "Male"
#      ROLE:  "Student"
#      CLASS_NAME: "New Class"
#      USERNAME: "studentauser"
#      PASSWORD: "test123"
#      QR_BADGE_LINK: ${output.SCHOOL_URL}respect_school_link/personqrbadge/id/12312
#- back
#

- runFlow:
    file: "subflows/add_person_to_a_class.yaml"
    env:
      ADD_USER: "Add Teacher"
      FIRSTNAME: "TeacherA"
      LASTNAME:  "User"
      GENDER: "Male"
      ROLE:  "Teacher"
      CLASS_NAME: "New Class"
      USERNAME: "teacherauser"
      PASSWORD: "test123"
- tapOn: "Apps"
- assertVisible:
    id: "app_title"
    text: "Apps"
- runFlow:
    file: "subflows/school_user_login_flow.yaml"
    env:
      SCHOOL_NAME: ${SCHOOL_NAME}
      USERNAME: "teacherauser"
      PASSWORD: "test123"

- assertVisible: "Apps"
- tapOn: "Classes"
- assertVisible:
    id: "app_title"
    text: "Classes"
- assertVisible: "New Class"
- tapOn: "Assignments"
- tapOn:
    id: "floating_action_button"   #  +Assignment button
- assertVisible:
    id: "app_title"
    text: "Add assignment"
- tapOn: "Save"
- assertVisible: "Required field"
- tapOn: "Assignment name*"
- inputText: "Homework 1"
- tapOn: "Class"
- tapOn: "New Class"
- tapOn: "Date"
- runScript:
    file: "scripts/setDate.js"
- inputText: ${output.futureDate}
- tapOn: "Time"
- runScript:
    file: "scripts/setDate.js"
- inputText: ${output.currentTime}
- tapOn: "Lesson/assessment"
- assertVisible:
    id: "app_title"
- tapOn: "My app"
- tapOn: "Grade 1"
- tapOn: "Lesson 001"
- tapOn: "Save"
- assertVisible:
    id: "app_title"
    text: "Homework 1"
- assertVisible: "Lesson 001"
- back
- assertVisible: "Homework 1"

