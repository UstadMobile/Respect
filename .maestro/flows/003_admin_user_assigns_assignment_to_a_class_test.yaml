appId: world.respect.app
onFlowStart:
  - clearState: world.respect.app
  - runScript:
      file: "scripts/school_init.js"
      env:
        TESTCONTROLLER_URL: ${TESTCONTROLLER_URL}
        SCHOOL_ADMIN_PASSWORD: ${SCHOOL_ADMIN_PASSWORD}
        DIR_ADMIN_AUTH_HEADER: ${DIR_ADMIN_AUTH_HEADER}
        SCHOOL_URL: ${SCHOOL_URL}
        SCHOOL_NAME: ${SCHOOL_NAME}
        URL_SUBSTITUTION: ${URL_SUBSTITUTION}
        NAME: "003_admin_user_assigns_assignment_to_a_class_test"

onFlowComplete:
  - runScript:
      file: "scripts/teardown.js"
---
# Admin login to the Respect app
- runFlow: "subflows/school_admin_login_flow.yaml"
# Admin add a new class to the Respect app
- runFlow: "subflows/admin_add_class.yaml"
# Admin add a new app to the Apps screen
- runFlow: "subflows/admin_add_app.yaml"
# Admin add a teacher to the class
- runFlow:
    file: "subflows/admin_add_teacher.yaml"
    env:
      TEACHER_FIRSTNAME: "TeacherA"
      TEACHER_LASTNAME: "User"
      TEACHER_USERNAME: "teachera"
      TEACHER_PASSWORD: "testta"
# Admin add 2 students to the class
- runFlow:
    file: "subflows/admin_add_student.yaml"
    env:
      STUDENT_FIRSTNAME: "StudentA"
      STUDENT_LASTNAME: "User"
      STUDENT_USERNAME: "studenta"
      STUDENT_PASSWORD: "testsa"
- runFlow:
    file: "subflows/admin_add_student.yaml"
    env:
      STUDENT_FIRSTNAME: "StudentB"
      STUDENT_LASTNAME: "User"
      STUDENT_USERNAME: "studentb"
      STUDENT_PASSWORD: "testsb"

# Teacher add a new assignment and assign to the class
- runFlow:
    file: "subflows/school_user_login_flow.yaml"
    env:
      USER_USERNAME: "teachera"
      USER_PASSWORD: "testta"

- tapOn: "Assignments"
- tapOn:
    id: "floating_action_button"   #  +Assignment button
- assertVisible:
    id: "app_title"
    text: "Add assignment"
- tapOn: "Save"
- assertVisible: "Required field"
- tapOn: "Name*"
- inputText: "Homework 1"
- tapOn: "Class"
- tapOn: "New Class"
- tapOn: "Description"
- inputText: "Test text"
- tapOn: "Date"
- runScript:
    file: "scripts/setDate.js"
- inputText: ${output.tomorrowDate}
- tapOn: "Time"
- runScript:
    file: "scripts/setDate.js"
- inputText: ${output.currentTime}
- tapOn: "Class comments"
- inputText: "Hi Students, please do complete this assignment before the deadline"
- tapOn: "Lesson/assessment"
- assertVisible:
    id: "app_title"
- tapOn: "My app"
- tapOn: "Grade 1"
- tapOn: "Lesson 001"
- tapOn: "Save"
- assertVisible:
    id: "app_title"
    text: "Homework 1"
- assertVisible: "Lesson 001"
- back
- assertVisible: "Homework 1"

# Student A complete the assignment
- runFlow:
    file: "subflows/school_user_login_flow.yaml"
    env:
      USER_USERNAME: "studenta"
      USER_PASSWORD: "testsa"
- tapOn: "Assignments"
- tapOn: "Homework 1"
- tapOn: "Lesson_001"
- tapOn: "Open"
- extendedWaitUntil:
    visible: "Lesson 001"
    timeout: 1000
- assertVisible: "Hello World Lesson"
- tapOn: "Close"

# Teacher able to see the assignment progress
- runFlow:
      file: "subflows/school_user_login_flow.yaml"
      env:
        USER_USERNAME: "teachera"
        USER_PASSWORD: "testta"
- tapOn: "Login"
- tapOn: "Assignments"
- tapOn: "Homework 1"
- assertVisible: "Completed"
- assertVisible: "1/2"
- assertVisible: "StudentA User"
- assertVisible: "Lesson_001"
- assertVisible: "100%"
- assertVisible: "StudentB User"
